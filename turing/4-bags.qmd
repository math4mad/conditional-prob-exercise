---
title: "4-bags"
author: math4mad
code-fold: true
---

:::{.callout-note title="ç®€ä»‹"}
   å‚è€ƒ: [`hakank-bayes-code:book_bags`](http://www.hakank.org/julia/turing/book_bags.jl)

   æœ‰ä¸¤ä¸ªåŒ…, åˆ†åˆ«ä¸º Bag1:[ğŸ”´:7,ğŸ”µ:3],Bag2:[ğŸ”´:3,ğŸ”µ:7]
   ä¸¤è€…è¢«é€‰ä¸­çš„æœºä¼šç›¸åŒ,ä»ä¸­æŒ‘å‡ºä¸€ä¸ªåŒ…,å¹¶æŠ½å‡ºçƒ,åœ¨æœ‰æ”¾å›çš„æ¡ä»¶ä¸‹:
   åˆ†åˆ«è®¡ç®—åœ¨æŠ½å‡º 1:5 ä¸ªè“è‰²çƒæ—¶ æ¥è‡ªä¸¤ä¸ªåŒ…çš„æ¦‚ç‡
:::


## 1. æ¦‚ç‡è·¯å¾„å›¾
```{mermaid}
%%| fig-width: 6.5
%%| label: fig-1
%%| fig-cap: bags-flowchart
flowchart LR

     twoBags("ğŸ‘œ")==b1:1/2 ==>Bag1("ğŸ”´ ğŸ”´ ğŸ”´ ğŸ”´ ğŸ”´ ğŸ”´ \n ğŸ”µ ğŸ”µ ğŸ”µ")
     twoBags("ğŸ‘œ")==b1:1/2==>Bag2("ğŸ”´ ğŸ”´ ğŸ”´\n ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ ")

      Bag1==b11:3/10==>Obs11("ğŸ”µ")
      Bag1==b12:3/10^2==>Obs12("ğŸ”µ ğŸ”µ")
      Bag1==b13:3/10^3==>Obs13("ğŸ”µ ğŸ”µ ğŸ”µ ")
      Bag1==b14:3/10^4==>Obs14("ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ")
      Bag1==b15:3/10^5==>Obs15("ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ")


      Bag2==b21:7/10==>Obs21("ğŸ”µ")
      Bag2==b22:7/10^2==>Obs22("ğŸ”µ ğŸ”µ")
      Bag2==b23:7/10^3==>Obs23("ğŸ”µ ğŸ”µ ğŸ”µ ")
      Bag2==b24:7/10^4==>Obs24("ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ")
      Bag2==b25:7/10^5==>Obs25("ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ ğŸ”µ")

```

### 1.1 åŸºäºæ¦‚ç‡è·¯å¾„å›¾çš„è®¡ç®—
ä»¥å–å‡ºä¸¤ä¸ªè“è‰²çƒä¸ºä¾‹åœ¨ @fig-1 ä¸­æœ‰ä¸¤æ¡è·¯å¾„

-  `b1->b12`
-  `b2->b22`
  
å–å‡ºä¸¤ä¸ªè“è‰²çƒçš„æ¦‚ç‡ä¸ºä¸¤æ¡è·¯å¾„çš„æ¦‚ç‡å’Œ,æ¯æ¡è·¯å¾„çš„æ¦‚ç‡é™¤ä»¥æ€»æ¦‚ç‡å°±æ˜¯æ¥è‡ªæŸä¸ªåŒ…çš„æ¦‚ç‡
å–å‡ºå…¶ä»–æ±‚çš„æ¦‚ç‡è®¡ç®—ç±»ä¼¼

### 1.2 computing
å®šä¹‰åŸºæœ¬æ¦‚ç‡
```{julia}
"é€‰ä¸­åŒ…çš„æ¦‚ç‡"
select_bag=1//2

b1blue=3;b1red=7;b1total=b1blue+b1red
b2blue=7;b2red=3;b2total=b2blue+b2red

"ä» bag1ä¸­æŠ½å‡ºnä¸ªè“è‰²çƒçš„æ¦‚ç‡"
pick_n_bag1=[(b1blue/b1total)^i for i in 1:5]

"ä» bag2ä¸­æŠ½å‡ºnä¸ªè“è‰²çƒçš„æ¦‚ç‡"
pick_n_bag2=[(b2blue/b2total)^i for i in 1:5]

@info "pick 1:5 ğŸ”µ from bag1"=> pick_n_bag1
@info "pick 1:5 ğŸ”µ from bag2"=> pick_n_bag2
```
è®¡ç®—æ¦‚ç‡
```{julia}
using DataFrames,GLMakie
 name1=Vector{String}(undef, 5)
 b1arr=Vector{Real}(undef, 5)
 b2arr=Vector{Real}(undef, 5)
 for idx in 1:5
     total=pick_n_bag1[idx]+pick_n_bag2[idx]
     name1[idx]="å–å‡º$(idx)ä¸ªğŸ”µ"
     b1arr[idx]=pick_n_bag1[idx]/total
     b2arr[idx]=pick_n_bag2[idx]/total

 end
 DataFrame(c1=name1,bag1=b1arr,bag2=b2arr)

```
ç»˜å›¾
```{julia}
  fig=Figure(resolution=(1000,300))
  for  idx in  1:5
    local ax=Axis(fig[1,idx];title="$idx blueball")
    ax.xticks=(1:2,["bag1","bag2"])
    local total=b1arr[idx]+b2arr[idx]
    @info [b1arr[idx],b2arr[idx]]
    stem!(ax,1:2,[b1arr[idx],b2arr[idx]]; trunkcolor = :blue, marker = :rect,stemcolor = :red, color = :orange)
  end
  fig

```

è¿ç»­å–å‡ºçš„è“è‰²çƒè¶Šå¤š, é€‰å‡ºçš„åŒ…ä¸º:bag2 çš„æ¦‚ç‡è¶Šå¤§, å› ä¸ºåˆå§‹æ¡ä»¶ä¸­,bag2 ä¸­è“è‰²çƒ
å æ¯”å¤§






## 2. turing  workflow
### 2.1  define turing model
```{julia}
include("utils.jl")
using Turing,Distributions
@model function book_bags(num_blue_chips=2)
    bag1 = 1 # 3 blue 7 red
    bag2 = 2 #  7 blue 3 red

    bag ~ Categorical([0.5,0.5])
    
    blue = 1
    red = 2

    n = 5
    draw = tzeros(num_blue_chips)
    for d in 1:num_blue_chips
        if bag == bag1
            draw[d] ~ Categorical([0.3,0.7])
        else
            draw[d] ~ Categorical([0.7,0.3])
        end
    end

    # We've seen $test number of blue chips
    for d in 1:num_blue_chips
        true ~ Dirac(draw[d] == blue)
    end

end

```

### 2.2  MCMC sampling
```{julia}
   num_chains = 4
   for idx in 1:5
    local model = book_bags(idx)
    chs = sample(model, MH(), 10_000)
    show_var_dist_pct(chs,:bag,["bag1","bag2"])
   end 
```

