---
title: "6-card-problem"
author: math4mad
code-fold: true
---

:::{.callout-note title="ç®€ä»‹"}
 å‚è€ƒ :"hakank-bayes-code"

 æœ‰ä¸€ä¸ªè¢‹å­,æœ‰ä¸‰å¼ ç‰Œ, ç¬¬ä¸€å¼ ä¸¤é¢éƒ½æ˜¯çº¢è‰², ç¬¬äºŒå¼ ä¸¤é¢éƒ½æ˜¯ç»¿è‰², ç¬¬ä¸‰å¼ ä¸€é¢çº¢è‰²,ä¸€é¢ç»¿è‰²
 ä»Žè¢‹å­éšæœºæŠ½å‡ºä¸€å¼ ç‰Œ, å¦‚æžœè§‚å¯Ÿåˆ°æ˜¯ç»¿è‰²çš„ä¸€é¢, æ¥è‡ªç¬¬ä¸‰å¼ ç‰Œçš„å‡ çŽ‡æ˜¯å¤šå¤§
:::

## 1 . æ¦‚çŽ‡è·¯å¾„å›¾

## 1.1 è·¯å¾„å›¾
```{mermaid}
%%| fig-width: 6.5
%%| label: fig-1
%%| fig-cap: box-cards-flowchart
flowchart LR
    box("Box")
    card1("card1:ðŸŸ¥,ðŸŸ¥")
    card2("card2:ðŸŸ©,ðŸŸ©")
    card3("card3:ðŸŸ¥,ðŸŸ©")
    box==c1:1/3==>card1
    box==c2:1/3==>card2
    box==c3:1/3==>card3
    card1==c1g1:0==>obsc11("ðŸŸ©")
    card1==c1r1:1==>obsc12("ðŸŸ¥")
    card2==c2g1:1==>obsc21("ðŸŸ©")
    card2==c2r1:0==>obsc22("ðŸŸ¥")
    card3==c3g1:1/2==>obsc31("ðŸŸ©")
    card3==c3r1:1/2==>obsc32("ðŸŸ¥")

```

## 1.2 æ ¹æ®è·¯å¾„å›¾çš„æ¦‚çŽ‡è®¡ç®—
åœ¨ @fig-1 ä¸­  èŽ·å–ç»¿è‰²ä¸€é¢çš„è·¯å¾„æœ‰ä¸¤æ¡:

1. `c2->c2g1`
2. `c3->c3g1`

```{julia}
 c2=c3=1//3
 c2g1=1
 c3g1=1//2
 p1=c2*c2g1;p2=c3*c3g1
 total= p1+p2
 "ç»¿è‰²ç‰Œé¢æ¥è‡ªç¬¬äºŒå¼ ç‰Œçš„æ¦‚çŽ‡ä¸º"=>p1//total

```

## 2 turing worflow
```{julia}
using Turing
include("utils.jl")
```

### 2.1  define model
```{julia}

@model function card_problem()
    red = 1
    green = 2
    
    all_red = 1
    all_green = 2
    red_green = 3
    
    #  What card did we select?
    selected_card ~ Categorical(simplex([1/3,1/3,1/3]))
    card ~ 
        selected_card == all_red   ?  Dirac(red) :
        selected_card == all_green ?  Dirac(green) :
        # [red,green]
        selected_card == red_green ?  Categorical([1/2,1/2]) : Dirac(0)
    true ~ Dirac(card == green)

end
```

### 2.2 mcmc sampling
```{julia}
chns = sample(card_problem(), MH(), 100_000)
display(chns)
show_var_dist_pct(chns, :selected_card,["all_red","all_green","red_green"])
```

